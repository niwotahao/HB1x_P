
/********************************************************************************************************

********************************************************************************************************/
#include "Lcd.h"
/********************************************************************************************************

********************************************************************************************************/
#define M_SPI
/********************************************************************************************************

********************************************************************************************************/
uint8 LcdWorkFlag = TRUE;
/********************************************************************************************************

********************************************************************************************************/
void uDelay(uint8 l)
{
	while(l--);
}
/********************************************************************************************************

********************************************************************************************************/
void Delay(uint8 n)
{
	uint8 i,j,k;

	for(k=0;k<n;k++)
	{
		for(i=0;i<131;i++)
		{
			for(j=0;j<15;j++)
			{
				uDelay(203);	
			}
		}
	}
}
/********************************************************************************************************

********************************************************************************************************/
void LCD_WriteCommand(uint8 Data)
{
#ifdef M_SPI
    uint8 i;
    
    OLED_CS=0;
    OLED_DC=0;
    for (i=0; i<8; i++)
    {
        OLED_SCLK=0;
        if(Data&0x80)
        {
            OLED_MOSI=1;
        }
        else
        {
            OLED_MOSI=0;
        }
        
        Data = Data << 1;
        uDelay(1);
        OLED_SCLK=1;
        uDelay(1);
    }
    OLED_SCLK=0;
    OLED_DC=1;
    OLED_CS=1;
    
    OLED_MOSI = 1;
#else
    OLED_CS=0;
    OLED_DC=0;
    bSpi_ReadWriteSpi1(Data);
    OLED_DC=1;
    OLED_CS=1;
#endif
}
/********************************************************************************************************

********************************************************************************************************/
void LCD_WriteData(uint8 Data)
{
#ifdef M_SPI
    uint8 i;

    OLED_CS=0;
    OLED_DC=1;
    for (i=0; i<8; i++)
    {
        OLED_SCLK=0;
        if(Data&0x80)
        {
            OLED_MOSI=1;
        }
        else
        {
            OLED_MOSI=0;
        }
        Data = Data << 1;
        uDelay(1);
        OLED_SCLK=1;
        uDelay(1);
    }
    OLED_SCLK=0;
    OLED_DC=1;
    OLED_CS=1;
    
    OLED_MOSI = 1;
#else
    OLED_CS=0;
    OLED_DC=1;
    bSpi_ReadWriteSpi1(Data);
    OLED_DC=1;
    OLED_CS=1;
#endif
}
/********************************************************************************************************
								设置开始列
********************************************************************************************************/
void LCD_SetStartColumn(uint8 d)
{
	LCD_WriteCommand(0x00+d%16);		
	LCD_WriteCommand(0x10+d/16);		
}
/********************************************************************************************************
								寻址模式
********************************************************************************************************/
void LCD_SetAddressingMode(uint8 d)
{
	LCD_WriteCommand(0x20);			
	LCD_WriteCommand(d);								
}
/********************************************************************************************************
								列地址
********************************************************************************************************/
void LCD_SetColumnAddress(uint8 a,uint8 b)
{
	LCD_WriteCommand(0x21);			
	LCD_WriteCommand(a);			
	LCD_WriteCommand(b);			
}
/********************************************************************************************************
								页地址
********************************************************************************************************/
void LCD_SetPageAddress(uint8 a,uint8 b)
{
	LCD_WriteCommand(0x22);
	LCD_WriteCommand(a);
	LCD_WriteCommand(b);
}
/********************************************************************************************************
								设置开始行
********************************************************************************************************/
void LCD_SetStartLine(uint8 d)
{
	LCD_WriteCommand(0x40|d);					
}
/********************************************************************************************************
								对比度设置
********************************************************************************************************/
void LCD_SetContrastControl(uint8 d)
{
	LCD_WriteCommand(0x81);			
	LCD_WriteCommand(d);			
}
/********************************************************************************************************
								电荷泵
********************************************************************************************************/
void LCD_SetChargePump(uint8 d)
{
	LCD_WriteCommand(0x8D);			
	LCD_WriteCommand(0x10|d);			
}
/********************************************************************************************************
								段交换
********************************************************************************************************/
void LCD_SetSegmentRemap(uint8 d)
{
	LCD_WriteCommand(0xA0|d);			
}
/********************************************************************************************************
								整体显示
********************************************************************************************************/
void LCD_SetEntireDisplay(uint8 d)
{
	LCD_WriteCommand(0xA4|d);			
}
/********************************************************************************************************
								全屏反白显示
********************************************************************************************************/
void LCD_SetInverseDisplay(uint8 d)
{
	LCD_WriteCommand(0xA6|d);			
}
/********************************************************************************************************
								对路对比
********************************************************************************************************/
void LCD_SetMultiplexRatio(uint8 d)
{
	LCD_WriteCommand(0xA8);			
	LCD_WriteCommand(d);			
}
/********************************************************************************************************
								LCD关闭
********************************************************************************************************/
void LCD_SetDisplayOnOff(uint8 d)	
{
	LCD_WriteCommand(0xAE|d);																
}
/********************************************************************************************************
								设置开始页
********************************************************************************************************/
void LCD_SetStartPage(uint8 d)
{
	LCD_WriteCommand(0xB0|d);				
}
/********************************************************************************************************
								反向显示
********************************************************************************************************/
void LCD_SetCommonRemap(uint8 d)
{
	LCD_WriteCommand(0xC0|d);									
}
/********************************************************************************************************
								显示补偿
********************************************************************************************************/
void LCD_SetDisplayOffset(uint8 d)
{
	LCD_WriteCommand(0xD3);			
	LCD_WriteCommand(d);			
}
/********************************************************************************************************
								显示时钟
********************************************************************************************************/
void LCD_SetDisplayClock(uint8 d)
{
	LCD_WriteCommand(0xD5);			
	LCD_WriteCommand(d);					
}
/********************************************************************************************************
								
********************************************************************************************************/
void LCD_SetPrechargePeriod(uint8 d)
{
	LCD_WriteCommand(0xD9);			
	LCD_WriteCommand(d);					
}
/********************************************************************************************************
									设置公共配置
********************************************************************************************************/
void LCD_SetCommonConfig(uint8 d)
{
	LCD_WriteCommand(0xDA);			
	LCD_WriteCommand(0x02|d);								
}
/********************************************************************************************************
									设置VCOMH
********************************************************************************************************/
void LCD_SetVCOMH(uint8 d)
{
	LCD_WriteCommand(0xDB);			
	LCD_WriteCommand(d);			
}
/********************************************************************************************************
									设置NOP
********************************************************************************************************/
void LCD_SetNOP(void)
{
	LCD_WriteCommand(0xE3);			
}
/********************************************************************************************************

********************************************************************************************************/
void LCD_Init(void)
{
    uint8 i;

	OLED_RES=0;
	for(i=0;i<200;i++)
	{
		uDelay(200);
	}
	OLED_RES=1;

	LCD_SetDisplayOnOff(0x00);		
	LCD_SetDisplayClock(0x80);		
	LCD_SetMultiplexRatio(0x3F);		
	LCD_SetDisplayOffset(0x00);		
	LCD_SetStartLine(0x00);			
	LCD_SetChargePump(0x04);			
	LCD_SetAddressingMode(0x02);		
	LCD_SetSegmentRemap(0x01);		
	LCD_SetCommonRemap(0x08);			
	LCD_SetCommonConfig(0x10);		
	LCD_SetContrastControl(Brightness);	
	LCD_SetPrechargePeriod(0xF1);		
	LCD_SetVCOMH(0x40);			
	LCD_SetEntireDisplay(0x00);		
	LCD_SetInverseDisplay(0x00);
    
	LCD_SetDisplayOnOff(0x01);
}
/********************************************************************************************************
							
********************************************************************************************************/
void LCD_SetWork(BOOL on)
{
    if(on == TRUE)
    {
        LCD_SetDisplayOnOff(0X01);
        LcdWorkFlag = TRUE;
    }
    else
    {
        LCD_SetDisplayOnOff(0X00);
        LcdWorkFlag = FALSE;
    }
}
/********************************************************************************************************

********************************************************************************************************/

